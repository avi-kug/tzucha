# ✅ Checklist - התקנת מערכת התמיכות

## קבצים שנוצרו (יש לוודא שכולם קיימים)

### Backend
- [x] `sql/create_supports_table.sql` - סקריפט יצירת טבלה
- [x] `repositories/SupportsRepository.php` - ניהול נתונים
- [x] `pages/supports_api.php` - API endpoints
- [x] `pages/supports.php` - דף ממשק משתמש

### Frontend
- [x] `assets/css/supports.css` - עיצוב
- [x] `assets/js/supports.js` - לוגיקה

### תיעוד
- [x] `SUPPORTS_README.md` - מדריך שימוש
- [x] `INSTALL_SUPPORTS.md` - מדריך התקנה
- [x] `SUPPORTS_SUMMARY.md` - סיכום המערכת
- [x] `SUPPORTS_CHECKLIST.md` - קובץ זה

### תיקיות
- [x] `uploads/temp/` - תיקייה לקבצים זמניים

---

## שלבי התקנה

### שלב 1: הכנת מסד הנתונים
```bash
# אופציה 1: דרך שורת הפקודה
cd c:\xampp\htdocs\tzucha
mysql -u root -p tzucha < sql/create_supports_table.sql

# אופציה 2: דרך phpMyAdmin
1. גש ל-http://localhost/phpmyadmin
2. בחר את מסד הנתונים 'tzucha'
3. לחץ על טאב 'SQL'
4. העתק את התוכן מ-sql/create_supports_table.sql
5. לחץ 'Go'
```
- [ ] הטבלה `supports` נוצרה במסד הנתונים

### שלב 2: הגדרת הרשאות
```sql
-- רק אם המשתמש שלך לא Admin
INSERT INTO user_permissions (user_id, permission_key) 
VALUES (1, 'supports');  -- החלף 1 ב-ID של המשתמש שלך
```
- [ ] למשתמש יש הרשאת 'supports'

### שלב 3: בדיקת תיקיות
```bash
# ודא שהתיקייה קיימת עם הרשאות כתיבה
cd c:\xampp\htdocs\tzucha\uploads
dir temp
# אם לא קיימת:
mkdir temp
```
- [ ] התיקייה `uploads/temp` קיימת
- [ ] יש הרשאות כתיבה לתיקייה

### שלב 4: בדיקת Dependencies
ודא ש-Composer packages מותקנים:
```bash
cd c:\xampp\htdocs\tzucha
composer install
```
- [ ] `phpoffice/phpspreadsheet` מותקן
- [ ] `mpdf/mpdf` מותקן
- [ ] `vendor/autoload.php` קיים

---

## בדיקות פונקציונליות

### ✅ בדיקה 1: גישה לדף
1. גש ל-http://localhost/tzucha/pages/supports.php
2. התחבר אם נדרש
3. ודא שהדף נטען בלי שגיאות

- [ ] הדף נטען בהצלחה
- [ ] אין שגיאות ב-Console
- [ ] יש 2 טאבים: "תמיכה" ו"נתונים"
- [ ] יש כפתורים: "הוסף תמיכה", "ייצוא לאקסל", "ייבוא מאקסל"

### ✅ בדיקה 2: הוספת רשומה ידנית
1. לחץ "הוסף תמיכה"
2. מלא לפחות: שם פרטי, שם משפחה, מס' נפשות בבית
3. הוסף כמה הכנסות והוצאות
4. לחץ "שמור"

- [ ] המודאל נפתח
- [ ] ניתן למלא את הטופס
- [ ] השמירה עובדת
- [ ] הרשומה מופיעה בטבלה
- [ ] יש הודעת הצלחה

### ✅ בדיקה 3: חישובים אוטומטיים
במקרה של:
- הכנסה: 3000 ₪
- הוצאות: 1000 ₪
- נפשות: 4

חישוב צפוי:
- סה"כ הכנסות: 3000
- סה"כ הוצאות: 1000
- הכנסה לנפש: (3000-1000)/4 = 500
- תמיכה: 500 < 700 → 200 × 4 = 800 ₪

- [ ] החישובים נכונים
- [ ] שורת הסיכום מציגה סכומים נכונים

### ✅ בדיקה 4: צ'ק בוקס הוצאה חריגה
1. הוסף רשומה עם הוצאה חריגה של 500 ₪
2. סמן את הצ'ק בוקס "כלול הוצאה חריגה"
3. בטל את הסימון

- [ ] כשמסומן - ההוצאה החריגה נספרת
- [ ] כשמבוטל - ההוצאה החריגה לא נספרת
- [ ] החישובים מתעדכנים בזמן אמת

### ✅ בדיקה 5: עריכת רשומה
1. לחץ על כפתור העריכה (✏️)
2. שנה ערך כלשהו
3. שמור

- [ ] המודאל נפתח עם הנתונים הקיימים
- [ ] ניתן לערוך
- [ ] העדכון עובד
- [ ] השינוי מופיע בטבלה

### ✅ בדיקה 6: מחיקת רשומה
1. לחץ על כפתור המחיקה (🗑️)
2. אשר את המחיקה

- [ ] יש בקשת אישור
- [ ] המחיקה עובדת
- [ ] הרשומה נעלמת מהטבלה

### ✅ בדיקה 7: החלפת טאבים
1. לחץ על טאב "נתונים"
2. חזור לטאב "תמיכה"

- [ ] טאב "נתונים" מציג את כל השדות
- [ ] המעבר בין טאבים חלק
- [ ] הנתונים נשמרים

### ✅ בדיקה 8: ייצוא ל-Excel
1. הוסף כמה רשומות
2. לחץ "ייצוא לאקסל"

- [ ] הקובץ מתחיל להיות מורד
- [ ] הקובץ נפתח ב-Excel
- [ ] כל הנתונים בקובץ
- [ ] הכותרות בעברית

### ✅ בדיקה 9: ייבוא מ-Excel
הכן קובץ Excel עם רשומה אחת לפחות:

| מזהה | תאריך יצירה | תאריך עדכון | שם עמדה | שם פרטי | שם משפחה | מספר זהות | עיר | רחוב | מס' טל' | מס' נפשות | ... |
|------|-------------|--------------|----------|---------|----------|-----------|-----|------|---------|-----------|-----|
| | | | | יוסי | כהן | 123456789 | ירושלים | הרצל 1 | 02-1234567 | 5 | ... |

1. לחץ "ייבוא מאקסל"
2. בחר את הקובץ

- [ ] הקובץ עולה בהצלחה
- [ ] יש הודעה על כמה רשומות נוספו
- [ ] הרשומות מופיעות בטבלה
- [ ] אם לא מזוהה - מוצג מסך שיוך

### ✅ בדיקה 10: בחירה מרשימת אנשים
1. לחץ "הוסף תמיכה"
2. בחר אדם מהרשימה
3. לחץ "טען נתונים"

- [ ] הרשימה מלאה באנשים
- [ ] הפרטים נטענים אוטומטית
- [ ] ניתן להמשיך למלא

---

## בדיקות אבטחה

### ✅ CSRF Protection
- [ ] יש CSRF token בטופס
- [ ] בקשות ללא token נדחות

### ✅ הרשאות
- [ ] משתמש ללא הרשאה לא יכול לגשת
- [ ] viewer לא יכול לערוך/למחוק
- [ ] admin יכול הכל

### ✅ Validation
- [ ] שדות חובה נבדקים
- [ ] מספרים מאומתים
- [ ] תאריכים תקינים

---

## בדיקות ביצועים

- [ ] טעינת 100 רשומות - חלקה
- [ ] ייבוא של 50 רשומות - מהיר (< 10 שניות)
- [ ] ייצוא של 100 רשומות - מהיר (< 5 שניות)
- [ ] המערכת לא תקועה/איטית

---

## בדיקות תצוגה

### דפדפנים
- [ ] Chrome - עובד
- [ ] Firefox - עובד
- [ ] Edge - עובד
- [ ] Safari - עובד

### מסכים
- [ ] מסך רחב (1920x1080) - נראה טוב
- [ ] מסך בינוני (1366x768) - נראה טוב
- [ ] מסך קטן (800x600) - responsive

---

## בעיות נפוצות ופתרונות

### ❌ "Table 'supports' doesn't exist"
**פתרון:** הרץ את `sql/create_supports_table.sql`

### ❌ "אין הרשאה לגישה"
**פתרון:** הוסף הרשאת 'supports' למשתמש

### ❌ "Failed to upload file"
**פתרון:** 
```bash
mkdir uploads/temp
chmod 777 uploads/temp
```

### ❌ "Call to undefined function"
**פתרון:** הרץ `composer install`

### ❌ שגיאות JavaScript
**פתרון:** נקה cache הדפדפן (Ctrl+Shift+Del)

### ❌ חישובים לא נכונים
**פתרון:** בדוק שמספרי נפשות > 0

---

## 🎉 סיימנו!

אם כל הבדיקות עברו בהצלחה - **מזל טוב!** המערכת פועלת כראוי.

### צעדים הבאים:
1. הוסף נתונים אמיתיים
2. בצע גיבוי של מסד הנתונים
3. הדרך משתמשים איך להשתמש
4. תהנה ממערכת התמיכות החדשה! 🚀

---

**תאריך בדיקה:** ________________  
**נבדק על ידי:** ________________  
**סטטוס:** [ ] הכל עובד [ ] יש בעיות  
**הערות:** ___________________________________________________
