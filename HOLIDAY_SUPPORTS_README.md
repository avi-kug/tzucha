# מערכת תמיכות חגים - Holiday Supports System

## תיאור המערכת
מערכת מקיפה לניהול תמיכות חגים עם אפשרויות ייבוא מטפסים, חישובים אוטומטיים, ואישור תמיכות.

## תכונות עיקריות

### 1. טאב תמיכה
- הצגת כל התמיכות עם חישובים
- עלות תמיכה, תמיכה בסיסית (60%), תמיכה מלאה
- אישור תמיכות בודדות או מרובות
- סיכום כולל של התמיכות

### 2. טאב חישובים
- יצירת כללי חישוב מותאמים אישית
- חישוב לפי: גיל, עיר, נשואים, מספר ילדים
- שילוב מספר קטגוריות יחד
- החלת חישובים אוטומטית על הטפסים

### 3. טאב נתונים
- הצגת כל הטפסים שיובאו מה-JSON
- שיוך טפסים לתורמים
- סטטיסטיקות: סה"כ טפסים, משויכים, לא משויכים
- חישוב אוטומטי של גילאי ומין ילדים

### 4. טאב תמיכות שאושרו
- רשימת כל התמיכות שאושרו
- תאריך אישור ותאריך תמיכה
- סיכום סך התמיכות שאושרו
- סנכרון עם מודל התורם במערכת

## התקנה

### 1. יצירת טבלאות במסד הנתונים
```bash
# הרץ את הסקריפט הבא ליצירת הטבלאות
php sql/run_holiday_supports_migration.php
```

או הרץ באופן ידני את הקובץ:
```bash
sql/create_holiday_supports_tables.sql
```

### 2. הרשאות
ודא שלמשתמש יש הרשאת `supports` במערכת.

### 3. קובץ הקונפיגורציה
אין צורך בהגדרות נוספות - המערכת משתמשת בהגדרות הקיימות.

## שימוש

### ייבוא נתונים מטופס JSON
1. לחץ על כפתור "ייבוא מטופס JSON"
2. הזן את כתובת ה-URL של הטופס (או השאר את ברירת המחדל)
3. לחץ "טען נתונים"
4. המערכת תייבא את כל הטפסים ותעדכן קיימים במידת הצורך

### יצירת כללי חישוב
1. עבור לטאב "חישובים"
2. לחץ "הוסף חישוב"
3. בחר קטגוריות (גיל, עיר, נשואים, ילדים)
4. הגדר תנאים וסכום תמיכה
5. שמור

### שיוך טפסים לתורמים
1. עבור לטאב "נתונים"
2. למצוא טפסים לא משויכים (מודגשים בכתום)
3. לחץ "שייך"
4. חפש את התורם ובחר אותו

### אישור תמיכות
1. עבור לטאב "תמיכה"
2. סמן תמיכות לאישור
3. לחץ "אשר נבחרים" או אשר תמיכה בודדת
4. התמיכות יעברו לטאב "תמיכות שאושרו"

### ייצוא לאקסל
- כל טאב ניתן לייצא לאקסל בנפרד
- לחץ על "ייצוא לאקסל" בעת הצגת הטאב הרצוי

## מבנה הטבלאות

### holiday_supports
טבלת תמיכות חגים עם סכומים וסטטוסים

### holiday_forms
טבלת טפסים שיובאו מה-JSON עם כל הפרטים

### holiday_form_kids
טבלת ילדים מהטפסים (שם, גיל, מין)

### holiday_calculations
טבלת כללי חישוב

## API Endpoints

### GET holiday_supports_api.php
- `action=get_data&tab=support` - קבלת נתוני תמיכות
- `action=get_data&tab=calculations` - קבלת כללי חישוב
- `action=get_data&tab=data` - קבלת טפסים
- `action=get_data&tab=approved` - קבלת תמיכות מאושרות
- `action=get_stats` - סטטיסטיקות
- `action=export_excel&tab=[tab_name]` - ייצוא לאקסל

### POST holiday_supports_api.php
- `action=import_json` - ייבוא מ-JSON
- `action=save_calculation` - שמירת כלל חישוב
- `action=delete_calculation` - מחיקת כלל חישוב
- `action=save_support` - שמירת תמיכה
- `action=delete_support` - מחיקת תמיכה
- `action=approve_supports` - אישור תמיכות
- `action=link_donor` - שיוך טופס לתורם
- `action=search_donors` - חיפוש תורמים
- `action=apply_calculations` - החלת חישובים

## קבצים

### Frontend
- `pages/holiday_supports.php` - דף ראשי
- `assets/js/holiday_supports.js` - לוגיקת JavaScript
- `assets/css/holiday_supports.css` - עיצוב

### Backend
- `pages/holiday_supports_api.php` - API
- `repositories/PeopleRepository.php` - גישה לנתוני תורמים

### Database
- `sql/create_holiday_supports_tables.sql` - סקריפט יצירת טבלאות
- `sql/run_holiday_supports_migration.php` - הרצת המיגרציה

## טיפים

### מיפוי שדות JSON
המערכת תומכת בכל השדות הבאים מה-JSON:
- פרטים אישיים: שם מלא, כתובת, עיר
- הכנסות: משכורות, הכנסות נוספות, קצבאות
- הוצאות: שכר לימוד, דירה, הוצאות חריגות
- ילדים: עד 16 ילדים עם פרטים מלאים
- נשואים: חלוקה לפי שנות נישואין (0-3, 3-9, 9+)
- בנק: פרטי חשבון בנק

### חישובים מורכבים
אפשר לשלב מספר תנאים:
- גיל 0-5 + עיר ירושלים = 600 ש"ח
- 4-6 ילדים + נשואים 3-9 שנים = 1000 ש"ח
- כל שילוב של התנאים

### סנכרון למודל התורם
כאשר תמיכה מאושרת:
- היא מסתנכרנת אוטומטית למודל התורם
- מופיעה בקטגוריה "תמיכות חגים"
- כוללת את הסכום והתאריך

## תמיכה
לשאלות או בעיות, פנה למפתח המערכת.
